<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>CHINACNU é’¢å·æŠ¥ä»·ç³»ç»Ÿ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Segoe UI', sans-serif;
      -webkit-font-smoothing: antialiased;
    }
    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      background: linear-gradient(120deg, #e6ffe6, #ccffcc);
      z-index: -1;
    }
    body > div.content {
      position: relative;
      z-index: 1;
      max-width: 800px;
      margin: auto;
      padding: 30px 20px;
      background: #ffffffcc;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0, 128, 0, 0.1);
    }
    h1 {
      text-align: center;
      color: #2e7d32;
      font-size: 6vw;
      max-font-size: 28px;
      margin-bottom: 24px;
    }
    label {
      display: block;
      margin-top: 16px;
      font-weight: bold;
      color: #1b5e20;
    }
    select, input, button {
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      font-size: 1rem;
      border: 1px solid #a5d6a7;
      border-radius: 8px;
      box-sizing: border-box;
    }
    button {
      background-color: #66bb6a;
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #43a047;
    }
    .result {
      margin-top: 30px;
      background: #e8f5e9;
      padding: 20px;
      border: 1px solid #a5d6a7;
      border-radius: 8px;
      color: #2e7d32;
      word-break: break-word;
    }
    .hidden { display: none; }
    button:disabled { background: #c8e6c9; cursor: not-allowed; }

    @media (max-width: 600px) {
      h1 { font-size: 22px; }
      .content {
        padding: 20px 15px;
        margin: 10px;
      }
      select, input, button {
        font-size: 15px;
      }
    }
  </style>
</head>
<body>

<div id="particles-js"></div>

<div class="content">
  <h1>CHINACNU é’¢å·æŠ¥ä»·ç³»ç»Ÿ</h1>

  <label>äº§å“ç§ç±»</label>
  <select id="product" onchange="updateFields()">
    <option value="å½©æ¶‚æ¿(æ–°å¢)">å½©æ¶‚æ¿(æ–°å¢)</option>
    <option value="æœ‰èŠ±é•€é”Œ åšæ¿">æœ‰èŠ±é•€é”Œ åšæ¿</option>
    <option value="æœ‰èŠ±é•€é”Œ (è–„æ¿)å¸¦ç²¾åŒ…">æœ‰èŠ±é•€é”Œ (è–„æ¿)å¸¦ç²¾åŒ…</option>
    <option value="é•€é“é”Œæ— è€æŒ‡çº¹">é•€é“é”Œæ— è€æŒ‡çº¹</option>
    <option value="ç½‘çº¹æ¿">ç½‘çº¹æ¿</option>
  </select>

  <label>åšåº¦ (mm)</label>
  <input type="number" id="thickness" step="0.01" placeholder="ä¾‹å¦‚ï¼š0.35">

  <div id="zincWrapper">
    <label>é”Œå±‚å±‚æ•° (g/mÂ²)</label>
    <input type="number" id="zincCount" min="0" step="1" placeholder="ä¾‹å¦‚ï¼š40">
  </div>

  <div id="coatingWrapper" class="hidden">
    <label>æ¼†è†œå±‚æ•°</label>
    <input type="number" id="coatingCount" min="0" step="1" placeholder="ä¾‹å¦‚ï¼š15">
  </div>

  <div id="fingerprintWrapper" class="hidden">
    <label>è€æŒ‡çº¹ç±»å‹</label>
    <select id="fingerprint">
      <option value="none">æ— </option>
      <option value="clear">é€æ˜åŒé¢</option>
      <option value="color">å½©è‰²åŒé¢</option>
      <option value="gold">é‡‘è‰²åŒé¢</option>
      <option value="green">ç»¿è‰²å•é¢</option>
    </select>
  </div>

  <label>å½“å‰æ±‡ç‡ (USDå…‘CNY)</label>
  <input type="number" id="rate" step="0.01" value="7.20">

  <label>ç¾å…ƒæµ·è¿è´¹ï¼ˆå¦‚éœ€è®¡ç®— CIFï¼‰</label>
  <input type="number" id="freightUSD" step="0.01" placeholder="ä¾‹å¦‚ï¼š25">

  <button id="calcBtn" onclick="calculate()">è·å–æŠ¥ä»·</button>

  <div class="result" id="result"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script>
particlesJS("particles-js", {
  particles: {
    number: { value: 40 },
    color: { value: "#81c784" },
    shape: { type: "circle" },
    opacity: { value: 0.5 },
    size: { value: 3 },
    line_linked: {
      enable: true,
      distance: 120,
      color: "#66bb6a",
      opacity: 0.4,
      width: 1
    },
    move: { enable: true, speed: 2 }
  }
});
</script>

<script>
function updateFields() {
  const type = document.getElementById("product").value;
  document.getElementById("coatingWrapper").classList.add("hidden");
  document.getElementById("fingerprintWrapper").classList.add("hidden");
  document.getElementById("zincWrapper").classList.remove("hidden");

  if (type === "å½©æ¶‚æ¿(æ–°å¢)") document.getElementById("coatingWrapper").classList.remove("hidden");
  if (type === "é•€é“é”Œæ— è€æŒ‡çº¹") document.getElementById("fingerprintWrapper").classList.remove("hidden");
  if (type === "ç½‘çº¹æ¿") {
    document.getElementById("zincWrapper").classList.add("hidden");
    document.getElementById("coatingWrapper").classList.add("hidden");
    document.getElementById("fingerprintWrapper").classList.add("hidden");
  }
}

async function calculate() {
  const btn = document.getElementById("calcBtn");
  btn.disabled = true;
  btn.innerText = "è®¡ç®—ä¸­...";

  const product = document.getElementById("product").value;
  const thickness = parseFloat(document.getElementById("thickness").value);
  const zincInput = document.getElementById("zincCount")?.value;
  const coatingInput = document.getElementById("coatingCount")?.value;
  const fingerprint = document.getElementById("fingerprint")?.value || "none";
  const rate = parseFloat(document.getElementById("rate").value);
  const freightUSD = parseFloat(document.getElementById("freightUSD").value) || 0;

  if (!thickness || isNaN(thickness)) {
    document.getElementById("result").innerHTML = "â— è¯·å¡«å†™åšåº¦";
    resetButton(); return;
  }
  if (!rate || isNaN(rate)) {
    document.getElementById("result").innerHTML = "â— è¯·å¡«å†™æ­£ç¡®çš„æ±‡ç‡";
    resetButton(); return;
  }

  const baseZincMap = {
    "å½©æ¶‚æ¿(æ–°å¢)": 15,
    "æœ‰èŠ±é•€é”Œ åšæ¿": 30,
    "æœ‰èŠ±é•€é”Œ (è–„æ¿)å¸¦ç²¾åŒ…": 20,
    "é•€é“é”Œæ— è€æŒ‡çº¹": 18,
    "ç½‘çº¹æ¿": 15
  };
  const baseCoatingMap = { "å½©æ¶‚æ¿(æ–°å¢)": 13 };

  const userZinc = zincInput ? parseInt(zincInput) : baseZincMap[product] || 0;
  const userCoating = coatingInput ? parseInt(coatingInput) : baseCoatingMap[product] || 0;

  const zincCount = Math.max(0, userZinc - (baseZincMap[product] || 0));
  const coatingCount = Math.max(0, userCoating - (baseCoatingMap[product] || 0));

  const fetchProduct = (product === "ç½‘çº¹æ¿") ? "å½©åŸºæ¿" : product;
  const sheetId = "1L8RGRPI7BdIlDew99K7QIXU5f7llOLqWqskwXb1lms4";
  const range = "A1:Z100";
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/'${encodeURIComponent(fetchProduct)}'!${range}?key=AIzaSyB-io6C9S0y5I6YXMi9TrDbAx8PkC2ReKo`;

  try {
    const res = await fetch(url);
    const data = await res.json();
    const headers = data.values[0];
    const rows = data.values.slice(1);
    const thicknessCol = headers.findIndex(h => h.includes("åšåº¦"));
    const priceCol = headers.findIndex(h => h.includes("1000RMB"));

    let closestRow = null, minDiff = Infinity;
    for (const row of rows) {
      const t = parseFloat(row[thicknessCol]);
      if (!isNaN(t)) {
        const diff = Math.abs(t - thickness);
        if (diff < 0.01 && diff < minDiff) {
          minDiff = diff;
          closestRow = row;
        }
      }
    }

    if (!closestRow) {
      document.getElementById("result").innerHTML = `æœªæ‰¾åˆ°åšåº¦ ${thickness} çš„æŠ¥ä»·ã€‚`;
      resetButton(); return;
    }

    const basePrice = parseFloat(closestRow[priceCol]);
    const density = 7850;
    const volumePerTon = 1 / (density / 1000);
    const areaPerTon = volumePerTon / (thickness / 1000);

    const zincCost = areaPerTon * zincCount * 0.025;
    const coatingCost = (product === "å½©æ¶‚æ¿(æ–°å¢)") ? areaPerTon * coatingCount * 0.05 : 0;
    let fingerprintCost = 0;
    if (product === "é•€é“é”Œæ— è€æŒ‡çº¹") {
      if (fingerprint === "clear") fingerprintCost = areaPerTon * 0.23;
      if (fingerprint === "color") fingerprintCost = areaPerTon * 0.33;
      if (fingerprint === "gold") fingerprintCost = areaPerTon * 0.41;
      if (fingerprint === "green") fingerprintCost = areaPerTon * 0.23;
    }
    const patternBoardCost = (product === "ç½‘çº¹æ¿") ? areaPerTon * 1.35 : 0;

    const totalAdd = zincCost + coatingCost + fingerprintCost + patternBoardCost;
    const totalPrice = basePrice + totalAdd;
    const fobPrice = totalPrice + 200;
    const totalUSD = totalPrice / rate;
    const fobUSD = fobPrice / rate;
    const taxRate = 0.935;
    const totalTaxPrice = totalPrice / taxRate;
    const fobTaxPrice = fobPrice / taxRate;

    let cifPrice = null, cifPriceUSD = null, cifTaxPrice = null;
    if (freightUSD > 0) {
      const freightRMB = freightUSD * rate;
      cifPrice = fobPrice + freightRMB;
      cifPriceUSD = cifPrice / rate;
      cifTaxPrice = cifPrice / taxRate;
    }

    document.getElementById("result").innerHTML = `
      âœ… å‡ºå‚ä»·: Â¥${totalPrice.toFixed(2)} / $${totalUSD.toFixed(2)}<br>
      ğŸ§¾ å«ç¨å‡ºå‚ä»·: Â¥${totalTaxPrice.toFixed(2)} / $${(totalTaxPrice / rate).toFixed(2)}<br><br>

      ğŸš¢ FOBä»·: Â¥${fobPrice.toFixed(2)} / $${fobUSD.toFixed(2)}<br>
      ğŸ§¾ å«ç¨FOBä»·: Â¥${fobTaxPrice.toFixed(2)} / $${(fobTaxPrice / rate).toFixed(2)}<br><br>

      ğŸŒ CIFä»·: ${
        cifPrice
          ? `Â¥${cifPrice.toFixed(2)} / $${cifPriceUSD.toFixed(2)}<br>
             ğŸ§¾ å«ç¨CIFä»·: Â¥${cifTaxPrice.toFixed(2)} / $${(cifTaxPrice / rate).toFixed(2)}`
          : `<span style="color:gray">è¯·å¡«å†™ç¾å…ƒæµ·è¿è´¹è®¡ç®—</span>`
      }
      <hr>
      ğŸ“¦ æ˜ç»†åŠ ä»·ï¼š<br>
      ğŸ§ª é”Œå±‚: Â¥${zincCost.toFixed(2)}ï¼ˆè¶…å‡º ${zincCount}gï¼‰<br>
      ğŸ¨ æ¼†è†œ: Â¥${coatingCost.toFixed(2)}ï¼ˆè¶…å‡º ${coatingCount} å±‚ï¼‰<br>
      ğŸ›¡ï¸ è€æŒ‡çº¹: Â¥${fingerprintCost.toFixed(2)}<br>
      ğŸ§µ ç½‘çº¹: Â¥${patternBoardCost.toFixed(2)}<br>
      ğŸ” æ±‡ç‡: Â¥${rate.toFixed(2)} / USD
    `;
  } catch (err) {
    document.getElementById("result").innerHTML = "âŒ è·å–åŸä»·å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";
    console.error(err);
  }

  resetButton();
}

function resetButton() {
  const btn = document.getElementById("calcBtn");
  btn.disabled = false;
  btn.innerText = "è·å–æŠ¥ä»·";
}

updateFields();
</script>

</body>
</html>


